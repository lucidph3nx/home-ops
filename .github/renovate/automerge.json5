{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "packageRules": [
    // Enable automerge for patch updates (all packages)
    {
      "description": "Auto-merge patch updates",
      "matchUpdateTypes": ["patch"],
      "automerge": true,
      "automergeType": "pr",
      "ignoreTests": false
    },
    // Enable automerge for minor updates to Docker images
    {
      "description": "Auto-merge minor updates for Docker images",
      "matchDatasources": ["docker"],
      "matchUpdateTypes": ["minor"],
      "automerge": true,
      "automergeType": "pr",
      "ignoreTests": false
    },
    // Enable automerge for minor updates to Helm charts
    {
      "description": "Auto-merge minor updates for Helm charts",
      "matchDatasources": ["helm"],
      "matchUpdateTypes": ["minor"],
      "automerge": true,
      "automergeType": "pr",
      "ignoreTests": false
    },
    // Enable automerge for GitHub Actions
    {
      "description": "Auto-merge GitHub Actions updates",
      "matchManagers": ["github-actions"],
      "matchUpdateTypes": ["minor", "patch", "pin", "digest"],
      "automerge": true,
      "automergeType": "pr",
      "ignoreTests": false
    },
    // Disable automerge for major updates (require manual review)
    {
      "description": "Disable auto-merge for major updates",
      "matchUpdateTypes": ["major"],
      "automerge": false
    },
    // Tier 1: Never automerge critical cluster infrastructure (any update type)
    {
      "description": "Never auto-merge Tier 1 critical infrastructure",
      "matchPackageNames": [
        "k3s-io/k3s",
        "system-upgrade-controller",
        "rancher/k3s-upgrade",
        "cilium",
        "coredns",
        "traefik"
      ],
      "matchUpdateTypes": ["major", "minor", "patch", "pin", "digest"],
      "automerge": false
    },
    // Tier 2: Disable automerge for major/minor updates to critical infrastructure (patches allowed)
    {
      "description": "Tier 2: Disable auto-merge for major/minor updates (patches allowed)",
      "matchPackageNames": [
        "cert-manager",
        "trust-manager",
        "cilium",
        "cloudnative-pg",
        "coredns",
        "external-dns",
        "traefik",
        "kube-prometheus-stack",
        "longhorn"
      ],
      "matchUpdateTypes": ["major", "minor"],
      "automerge": false
    },
    // Disable automerge for databases
    {
      "description": "Disable auto-merge for databases",
      "matchPackagePatterns": [
        "postgres",
        "postgresql",
        "valkey",
        "redis"
      ],
      "matchUpdateTypes": ["major", "minor"],
      "automerge": false
    },
    // Special handling for home-assistant (calendar versioning)
    {
      "description": "Disable auto-merge for home-assistant (calendar versioning)",
      "matchPackagePatterns": [
        "home-assistant/home-assistant"
      ],
      "automerge": false
    }
  ]
}
